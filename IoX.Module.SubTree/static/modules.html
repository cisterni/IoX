<!DOCTYPE html>
<html>
	<head>
    <title>IoX Module Manager</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  	<script type="text/javascript" src="script/jquery-1.11.3.min.js"></script>
  	<script type="text/javascript" src="script/bootstrap.min.js"></script>
  	<script type="text/javascript" src="script/iox.js"></script>
    <script type="text/javascript">
			function updateModInfo(modInfo, m) {
				if (!m.Loaded) {
					var link = $('<a class="btn btn-link">Load</a>');
					link.click(function () { loadModule(modInfo, m); });
					modInfo.append(link);
				} else if (m.Browsable) {
					modInfo.html('<a class="btn btn-link" href="' + m.Url +'">View</a>');
				} else {
					modInfo.html('<i>Loaded</i>');
				}
			}

			function loadModule(modInfo, m) {
				modInfo.html('<i>Loading...</i>');
		    iox.post_json("load-module", m.Id, function (data, status) {
		      if (status == "success")
		        updateModInfo(modInfo, data);
		      else
		        modInfo.html('<i>Error (TODO)</i>');
		    });
			}

			$(document).ready(function () {
				var content = $('#content');
		    iox.available_modules(
	        function () { content.html(""); },
	        function (m) {
						var modElement = $(
			        '<div class="panel panel-info">' +
			          '<div class="panel-heading"><h3 class="panel-title">' + m.Name + '</h3></div>' +
			          '<div class="panel-body">' +
			            '<p>' + m.Description + '</p>' +
									'<p><div class="module-dyn-info"></div></p>' +
			          '</div>' +
			        '</div>');
						updateModInfo(modElement.find(".module-dyn-info"), m);
						content.append(modElement);
	        }
			  );
			});
    </script>
	</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">IoX</a>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a class="dropdown-toggle" role="button" aria-expanded="false" href="#" data-toggle="dropdown" onclick="iox.update_modules_list('')">Modules <span class="caret"></span></a>
                        <ul class="dropdown-menu" role="menu" id="ModulesDropDown">
                            <li class="divider"></li>
                            <li><a href="/modules.html">Manage modules</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
<div class="container" style="margin-top: 20px">
        <div class="page-header">
            <h1>Manage modules</h1>
        </div>
    <div id="content">
        <div class="text-center">
            <img src="img/throbber.gif" width="64" />
        </div>
    </div>
</div>
</body>
</html>
